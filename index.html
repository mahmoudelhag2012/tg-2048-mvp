<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2048 Mini — MVP</title>

  <!-- Telegram Mini App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- AdsGram SDK -->
  <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
  <!-- Telega.io SDK -->
  <script src="https://inapp.telega.io/sdk/v1/sdk.js"></script>

  <style>
    :root{ --bg:#faf8ef; --board:#bbada0; --tile:#cdc1b4; --text:#776e65; --btn:#8f7a66; --white:#fff; }
    *{box-sizing:border-box}
    body{font-family:system-ui,Arial;padding:16px;margin:0;background:var(--bg);color:var(--text);}
    .wrap{max-width:480px;margin:0 auto;position:relative}
    h1{margin:0 0 8px;font-size:32px;line-height:1.1;padding-right:50px}
    .top{display:flex;gap:8px;justify-content:center;margin-bottom:8px}
    .card{background:var(--board);color:var(--white);border-radius:12px;padding:8px 12px;min-width:100px;text-align:center}
    .grid{background:var(--board);border-radius:12px;padding:8px;display:grid;grid-template-columns:repeat(4,1fr);gap:8px;touch-action:none}
    .cell{height:80px;background:var(--tile);border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:24px}
    button{padding:10px 12px;border:0;border-radius:12px;font-weight:700;background:var(--btn);color:var(--white);cursor:pointer}
    .controls{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:14px;justify-items:center;align-items:center}
    .controls .spacer{height:0}
    .arrow{min-width:96px;min-height:66px;font-size:20px}
    .menuBtn{position:absolute;top:8px;right:8px;width:32px;height:32px;padding:0;min-width:0;min-height:0;line-height:1;background:transparent;color:var(--btn);border:2px solid var(--btn);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:900;z-index:11}
    .backdrop{position:fixed;inset:0;background:#0007;display:none}
    .backdrop.show{display:block}
    .drawer{position:fixed;top:0;right:0;height:100dvh;width:220px;background:#f5efe6;box-shadow:0 0 30px #0003;padding:16px 14px;transform:translateX(100%);transition:transform .25s ease;z-index:12}
    .drawer.open{transform:translateX(0)}
    .drawer h3{margin:4px 0 12px}
    .menuItem{display:block;width:100%;margin:8px 0;padding:12px 14px;background:var(--btn);color:#fff;border:0;border-radius:12px;font-weight:700;cursor:pointer}
    .menuInfo{margin:6px 0 10px;font-weight:700;color:#333}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    small{opacity:.7}

    /* Splash */
    .splash{
      position:fixed;inset:0;z-index:1000;
      background:radial-gradient(120% 120% at 50% -20%,#fdf7ea 0%,#efe6d9 45%,#e7dccf 100%);
      display:none;
      align-items:center;justify-content:center;
      transition:opacity .35s ease,visibility .35s ease;
    }
    .splash.show{display:flex}
    .splash.hide{opacity:0;visibility:hidden}
    .splash-card{width:min(88vw,420px);background:#ffffffcc;border:1px solid #e9dfd3;border-radius:18px;box-shadow:0 10px 30px #00000014;padding:18px 18px 14px;text-align:center;backdrop-filter:blur(4px)}
    .splash-logo{width:100%;height:auto;border-radius:12px;display:block}
    .splash-title{margin:10px 0 6px;font-weight:800;letter-spacing:.4px;color:#5a4a3d}
    .splash-sub{margin:0 0 8px;color:#7b6d61;font-weight:600;font-size:14px}
    .bar{height:8px;width:100%;background:#eadfce;border-radius:999px;overflow:hidden}
    .bar>span{display:block;height:100%;width:0%;background:linear-gradient(90deg,#8f7a66,#b59d84);border-radius:999px;animation:fill 2.2s ease forwards}
    @keyframes fill{to{width:100%}}
    .tap-hint{margin-top:8px;font-size:12px;color:#998a7f}

    /* ===== Telega Banner (ثابت تحت) ===== */
    #telegaBanner{
      position: sticky;
      bottom: 0;
      width: 100%;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f5f5f5;
      border-radius: 10px;
      margin-top: 10px;
      padding: 6px;
      overflow: hidden;
    }
  </style>
</head>
<body>

<!-- Splash -->
<div id="splash" class="splash">
  <div class="splash-card" id="splashCard">
    <img id="splashImg" class="splash-logo" alt="Earn USDT — 2048 Mini">
    <h3 class="splash-title">Earn USDT while you play</h3>
    <p class="splash-sub">Watch ads at milestones and collect rewards</p>
    <div class="bar"><span></span></div>
    <div class="tap-hint">Tap to continue</div>
  </div>
</div>

<div class="wrap">
  <h1>2048 Mini</h1>
  <button id="menuBtn" class="menuBtn" aria-label="Menu">☰</button>

  <div class="top">
    <div class="card">Score<br><b id="score">0</b></div>
    <div class="card">Best<br><b id="best">0</b></div>
  </div>

  <div class="grid" id="grid"></div>

  <div class="controls">
    <span class="spacer"></span>
    <button id="up" class="arrow">▲</button>
    <span class="spacer"></span>
    <button id="left" class="arrow">◀</button>
    <button id="down" class="arrow">▼</button>
    <button id="right" class="arrow">▶</button>
  </div>

  <p><small>Swipe on the board or use the arrows. MVP build.</small></p>
</div>

<div id="backdrop" class="backdrop"></div>
<div id="drawer" class="drawer">
  <h3>Menu</h3>
  <div class="menuInfo">Balance (USDT): <span id="balance" class="mono">0.0000</span></div>
  <div class="menuInfo">Extra Lives: <span id="lives" class="mono">0</span></div>
  <button id="mNew" class="menuItem">New Game</button>
  <button id="mInvite" class="menuItem">Invite Friend</button>
  <button id="mShare" class="menuItem">Share</button>
  <button id="mAbout" class="menuItem">About</button>
  <button id="mClaim" class="menuItem" style="display:none">Claim</button>
</div>

<!-- Telega Banner -->
<div id="telegaBanner">Loading Ad…</div>

<script>
/* ===== حارس أخطاء عام ما يوقفش الصفحة ===== */
window.addEventListener('error', e => { try{ console.warn(e.message); }catch(_){} });

/* ===== Telegram ===== */
try{ const tg = window.Telegram?.WebApp; if (tg) tg.expand(); }catch(_){}

/* ===== Telega helpers ===== */
let telegaAds=null;
try{
  if (window.TelegaIn && window.TelegaIn.AdsController) {
    telegaAds = window.TelegaIn.AdsController.create_miniapp({
      token: 'a14e3947-839f-4b2a-aee0-5a3b1412c818'
    });
  }
}catch(_){}
const TELEG_UID_1024="3a1f1a7a-028c-4909-b20b-f4733d02fcc5";
const TELEG_UID_2048="6a5cb9ac-15d0-4da2-bbca-916236f1bc83";

/* === Banner UID === */
const TELEG_UID_BANNER = "6a5cb9ac-15d0-4da2-bbca-916236f1bc83";

function showTelega(uid){
  try{
    if (window.ads && typeof window.ads.ad_show==="function") return window.ads.ad_show({adBlockUuid:uid});
    if (telegaAds && typeof telegaAds.show==="function") return telegaAds.show();
  }catch(e){console.warn("Telega show error:",e)}
  return Promise.resolve();
}

function showTelegaBanner(){
  const el = document.getElementById('telegaBanner');
  if(!el) return;
  try{
    if (window.ads && typeof window.ads.ad_show === "function"){
      window.ads.ad_show({ adBlockUuid: TELEG_UID_BANNER, containerId: "telegaBanner", format: "banner" });
      return;
    }
    if (telegaAds && typeof telegaAds.show === "function"){
      telegaAds.show({ adBlockUuid: TELEG_UID_BANNER });
      return;
    }
    el.textContent = "No ads available";
  }catch(e){
    console.warn("Telega banner error:", e);
    el.textContent = "No ads available";
  }
}

/* باقي كود لعبتك … (بدون أي تغيير) */

// ابدأ اللعبة
// استدعاء البانر عند بداية اللعبة
window.addEventListener('load', () => {
  setup();
  setTimeout(maybeOfferDailyBonusInt, 1500);
  showTelegaBanner(); 

  // ✨ إعادة تحميل البانر كل 60 ثانية
  setInterval(showTelegaBanner, 60000);
});

</script>
</body>
</html>
